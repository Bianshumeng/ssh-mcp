# ssh-mcp 运维增强（profiles-test/错误上下文/重试/单次超时）

创建时间：2026-02-15 19:56:00

## 为什么做

当前运维链路缺少“快速连通性自检、可定位错误、握手失败自动重试、单次命令超时覆盖”的能力，导致排障成本高、信息不足、操作可控性差。

## 改什么

- 新增 MCP 工具 `profiles-test`：一键做 TCP 通、SSH 握手、认证。
- 错误信息补齐 `profileId/host/port` 目标上下文。
- 握手失败自动重试 2 次（指数退避）。
- `exec/sudo-exec` 支持单次命令 `timeoutMs` 覆盖。
- README 补充新工具与参数说明。

## 影响范围

- 涉及模块：`src/ssh/connection-manager.ts`、`src/tools/exec.ts`、`src/tools/sudo-exec.ts`、`src/tools/profiles.ts`、`src/ssh/ssh-config.ts`、`src/index.ts`
- 涉及接口：MCP tool 列表、`exec/sudo-exec` 参数
- 风险等级：L1

## 不做什么（边界）

- 不引入 Web UI 或数据库持久化
- 不改变 MCP 协议层行为
- 不暴露明文凭据

## 验证

- 单测：`profiles-test` 基本输出结构、`timeoutMs` 参数可用
- 集成：本地 SSH 测试环境下执行 `profiles-test` + `exec` 组合验证

## 回滚

- 回滚触发条件：profiles-test 影响连接稳定性、错误信息泄露、重试导致异常放大
- 回滚步骤：回退到上一稳定版本，移除新增工具与重试逻辑
