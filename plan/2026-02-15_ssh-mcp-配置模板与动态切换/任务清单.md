# 任务清单

## 1. 准备阶段
- [x] 1.1 阅读现有规格 | 验收：确认当前仓库无 `plan/` 体系，已补最小规格骨架
- [x] 1.2 确认无冲突进行中任务 | 验收：仓库为上游原始状态，无并行任务目录

## 2. 实现阶段
- [x] 2.1 设计并实现配置模型与加载器 | 验收：支持 YAML/JSON、ENV 展开、active 校验
- [x] 2.2 实现 profile 生命周期管理 | 验收：可列出/切换/重载/更新备注
- [x] 2.3 拆分 SSH 连接与命令执行模块 | 验收：`exec/sudo-exec` 行为兼容
- [x] 2.4 组装 MCP tools 并接入新管理工具 | 验收：新增工具可调用并返回脱敏数据
- [x] 2.5 更新 README 与示例配置 | 验收：文档可独立指导使用

## 3. 验证阶段
- [x] 3.1 单元测试通过 | 验收：新增单测全部通过
- [x] 3.2 关键场景验收通过 | 验收：profile 切换后命令目标变化、备注写回可复现

## 4. 收尾阶段
- [x] 4.1 合并规格变更到 `plan/规格/` | 验收：能力描述与场景更新
- [ ] 4.2 归档到 `plan/归档/` | 验收：任务通过后再归档

## 经验记录

### 步骤 1 完成记录
- 实际情况：原仓库不存在 `plan/` 与会话持久层文档，需先补最小规格门禁。
- 遇到问题：无
- 技术债：待观察是否需要后续补充更细的契约字段文档。

### 步骤 2 完成记录
- 实际情况：将 `src/index.ts` 拆分为 `cli/config/profile/ssh/tools` 分层，入口仅做组装。
- 遇到问题：ENV 展开后若直接写回会泄露明文，已改为“rawConfig 持久化 + expandedConfig 运行时”双轨。
- 技术债：`disableSudo` 仍为启动时注册策略，若需要运行时开关需额外设计动态 tool 能力声明。

### 步骤 3 完成记录
- 实际情况：新增测试覆盖配置解析、冲突参数、profile 切换目标变化、备注写回持久化。
- 遇到问题：本地无默认 SSH 测试容器时，原有集成测试会出现 `ECONNREFUSED 127.0.0.1:2222`。
- 技术债：建议后续把现有 live SSH 测试分组为可选集成套件，默认 CI 运行单测集。
