# ssh-mcp 配置模板与动态切换

创建时间：2026-02-15 00:00:00

## 为什么做

现有实现仅支持单目标 CLI 参数，无法满足运维常见的“多机器模板管理 + 运行时切换 + 备注沉淀”需求。

## 改什么

- 新增本地 profile 配置加载（YAML/JSON）与 ENV 展开。
- 新增 profile 生命周期管理（active、切换、重载、备注写回）。
- 拆分 `src/index.ts` 为 config/profile/ssh/tools 分层模块。
- 新增 MCP 工具：`profiles-list`、`profiles-use`、`profiles-reload`、`profiles-note-update`。
- 保留并兼容旧参数模式（`--host --user --password/--key`）。

## 影响范围

- 涉及模块：`src/index.ts`、`src/config/*`、`src/profile/*`、`src/ssh/*`、`src/tools/*`
- 涉及接口：CLI 参数、MCP tool 列表
- 风险等级：L2

## 不做什么（边界）

- 本次不涉及：Web UI、数据库持久化、多租户权限、MCP 协议变更
- 不做原因：需求目标聚焦在本地配置可运维与连接生命周期管理

## 验证（存在风险时必填）

- 单测：配置解析、ENV 展开、参数冲突校验
- 集成：profile 切换前后 `exec` 命令目标变化
- 兼容：旧参数模式仍可执行 `exec`

## 回滚（存在风险时必填）

- 回滚触发条件：旧模式不可用、profile 模式稳定性异常、敏感信息泄露
- 回滚步骤：
  - 回退到改造前版本
  - 仅保留旧参数模式运行
  - 清理新配置路径参数与 profile 管理工具调用

