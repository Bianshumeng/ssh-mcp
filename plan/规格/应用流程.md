# SSH MCP 增强版应用流程

最后更新：2026-02-15

## 能力概述

本流程定义启动模式判定、工具调用链路、profile 生命周期。

## 关联文档

- 产品需求：`plan/规格/产品需求.md`
- 后端结构：`plan/规格/后端结构.md`
- 实施计划：`plan/2026-02-15_ssh-mcp-配置模板与动态切换/实施计划.md`

## 需求列表

### 需求：启动模式路由

系统应当根据参数判定启动方式：旧参数模式或配置模式。

#### 场景：模式判定
- 当 启动参数包含 `--config`
- 那么 进入 profile 模式并禁止同时传目标直连参数

#### 场景：旧模式兼容
- 当 启动参数不包含 `--config` 但包含 `--host --user`
- 那么 进入旧参数模式

### 需求：profile 管理工具流程

系统应当支持 profile 列表、切换、重载、备注更新闭环。

#### 场景：查看列表
- 当 调用 `profiles-list`
- 那么 返回脱敏后的 profile 摘要及 active 标识

#### 场景：重载配置
- 当 调用 `profiles-reload`
- 那么 重新加载文件并校验 active profile 有效性

### 需求：命令执行流程稳定

系统应当在 profile 变化后保证后续命令连接到正确目标。

#### 场景：切换后执行命令
- 当 先调用 `profiles-use` 再调用 `exec`
- 那么 `exec` 使用新 profile 对应目标连接

